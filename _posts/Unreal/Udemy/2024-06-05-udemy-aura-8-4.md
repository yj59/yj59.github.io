---
title: "[GAS/sec8] RPG Attribute #2"

date: 2024-06-05 00:00:00 +0900
author: yejin

categories: [Unreal, Udemy]
tags: [unreal, GAS, lecture]

math: true
---

<br>

# **8. RPG Attribute**

<br>

## **8.8. Player Level & Combat Interface**

<br>

### **Player Level**

<br>

```c++
// AuraPlayerState.h
public:
  virtual void GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const override;

private:
  	UFUNCTION()
	void OnRep_Level(int32 OldLevel);
	
	
	UPROPERTY(VisibleAnywhere, ReplicatedUsing=OnRep_Level)
	int32 Level = 1;


// AuraPlayerState.cpp
void AAuraPlayerState::GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const
{
	Super::GetLifetimeReplicatedProps(OutLifetimeProps);

	DOREPLIFETIME(AAuraPlayerState, Level);
}
```

* `Level` ë³€ìˆ˜ë¥¼ Replicateí•˜ê¸° ìœ„í•´ `GetLifetimeReplicatedProps` í•¨ìˆ˜ ì¬ì •ì˜

* Levelì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ `OnRep_Level`í•¨ìˆ˜ í˜¸ì¶œ(notify)

  * `OldLevel` ë³€ìˆ˜ë¥¼ í†µí•´ ì´ì „ ê°’ê³¼ í˜„ì¬ ê°’ ë¹„êµ
  
  * `UFUNCTION()` ì„ ì–¸ì´ ìˆì–´ì•¼ notify ì—­í•  ìˆ˜í–‰ ê°€ëŠ¥
  
* `ReplicatedUsing`: Replicatedëœ ë³€ìˆ˜ê°€ ì„œë²„ì—ì„œ ë³€ê²½ë˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°”ì¸ë”© ëœ í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰
  
  * *eg) ì„œë²„ì—ì„œ ë³µì œëœ `Level` ë³€ê²½ ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ `OldRep_Level` í•¨ìˆ˜ê°€ ì‹¤í–‰ë¨*

* `DOREPLIFETIME(í´ë˜ìŠ¤ëª…, ë³µì œí•  ë³€ìˆ˜)`: ë³µì œëœ í•­ëª©ì„ í‘œì‹œí•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ë§¤í¬ë¡œ


<br>

### **Combat Interface**

<br>

ì „íˆ¬ë¥¼ ì „ìš©ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ í”Œë ˆì´ì–´ ìºë¦­í„°ì™€ ì  ìºë¦­í„°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. `AAuraCharacterBase` í´ë˜ìŠ¤ì˜ ë¶€ëª¨ í´ë˜ìŠ¤ë¡œ `CombatInterface` í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.

`AuraCharacter`ì˜ Levelì€ `AuraPlayerState` í´ë˜ìŠ¤ì— ì§€ì—­ ë³€ìˆ˜ë¡œ ìˆìœ¼ë¯€ë¡œ ìºë¦­í„° í´ë˜ìŠ¤ì˜ êµ¬í˜„ë¶€ì—ì„œ getterë¡œ ë°›ì•„ Levelì„ ë¦¬í„´í•œë‹¤.

<br>

```c++
// AuraPlayerState.h
FORCEINLINE int32 GetPlayerLevel() const { return Level; };

// AuraCharacter.cpp
int32 AAuraCharacter::GetPlayerLevel()
{
	const AAuraPlayerState* AuraPlayerState = GetPlayerState<AAuraPlayerState>();
	check(AuraPlayerState);
	
	return AuraPlayerState->GetPlayerLevel();
}
```

* ì¸ë¼ì¸ í•¨ìˆ˜ì— `FORCEINLINE` ë§¤í¬ë¡œë¥¼ ë¶™ì—¬ ìµœì í™”í•  ìˆ˜ ìˆë‹¤.
  
  * `GetPlayerLevel` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ì»´íŒŒì¼ ì´ì „ ì „ì²˜ë¦¬ê¸°ê°€ ëŒ€ì²´ (ì»´íŒŒì¼ ì†ë„ í–¥ìƒ)

<br>

#### ***ğŸ’¡ì£¼ì˜!***


ìºë¦­í„° í´ë˜ìŠ¤ì˜ ë¶€ëª¨ í´ë˜ìŠ¤ë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ë©´ ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ `TObjectPtr<IEnemyInterface>`ì— ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

`TObjectPtr`ì€ ê°€ë¦¬í‚¤ëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ìœ íš¨í•œì§€ ê²€ì‚¬í•˜ê¸° ìœ„í•´ í•˜ìœ„ í´ë˜ìŠ¤ì˜ ëª¨ë“  ë©¤ë²„ ë³€ìˆ˜ì™€ í•¨ìˆ˜ë¥¼ ê´€ë¦¬í•˜ëŠ”ë°, `AuraEnemy`ê°€ ìƒì†í•œ `ICombatInterface`ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸!

ì´ë ‡ê²Œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²½ìš°ì—ëŠ” `TObjectPtr` ëŒ€ì‹  ì›ì‹œ í¬ì¸í„°ë¥¼ ì‚¬ìš©í•´ ì›í•˜ëŠ” í´ë˜ìŠ¤ì— ë°”ë¡œ ì ‘ê·¼í•˜ì.

```c++
// AuraPlayerController.h
private:
	IEnemyInterface* LastActor; /** ì›ì‹œí¬ì¸í„°ë¡œ ë³€ê²½ */
	IEnemyInterface* ThisActor;
```


<br>


## **8.9. Modifier Magnitude Calculations**

<br> 

attributesë¥¼ ovrrideë‚˜ add ëŒ€ì‹  ì§ì ‘ ì»¤ìŠ¤í…€í•˜ê³  ì‹¶ë‹¤ë©´ MMC í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

<br>

```c++
// UMMC_MaxHealth.h
public:
	UMMC_MaxHealth();
		
	virtual float CalculateBaseMagnitude_Implementation(const FGameplayEffectSpec& Spec) const override;
```

* `FGameplayEffectSpec`ì— ì ‘ê·¼->Attribute ë‚´ë¶€ì˜ ëª¨ë“  ì •ë³´ì— ì•¡ì„¸ìŠ¤ê°€ ê°€ëŠ¥í•¨!

<br>


```c++
// UAuraAttributeSet.h
#define ATTRIBUTE_ACCESSORS(ClassName, PropertyName) \
		GAMEPLAYATTRIBUTE_PROPERTY_GETTER(ClassName, PropertyName) \
		GAMEPLAYATTRIBUTE_VALUE_GETTER(PropertyName) \
		GAMEPLAYATTRIBUTE_VALUE_SETTER(PropertyName) \
		GAMEPLAYATTRIBUTE_VALUE_INITTER(PropertyName)

UPROPERTY(BlueprintReadOnly, ReplicatedUsing = OnRep_Vigor, Category = "Primary Attributes")
FGameplayAttributeData Vigor;
ATTRIBUTE_ACCESSORS(UAuraAttributeSet, Vigor);


// UMMC_MaxHealth.cpp
UMMC_MaxHealth::UMMC_MaxHealth()
{
	/** ìº¡ì³í•  ì†ì„± ì§€ì • */
	VigorDef.AttributeToCapture = UAuraAttributeSet::GetVigorAttribute();
	
	/** AuraCharacterì—ê²Œ Vigor ìº¡ì²˜ */
	VigorDef.AttributeSource = EGameplayEffectAttributeCaptureSource::Target;
	VigorDef.bSnapshot = false;

	// ìº¡ì²˜í•  ì†ì„±ì€ RelevantAttributesToCaptureì— ì¶”ê°€í•´ì•¼ í•¨(TArray í˜•ì‹)
	RelevantAttributesToCapture.Add(VigorDef);
}


```

* `AuraAttributeSet` í´ë˜ìŠ¤ì—ì„œ `Vigor` ì†ì„±ì— ë§¤í¬ë¡œ ì‘ì„±

	* `GAMEPLAYATTRIBUTE_PROPERTY_GETTER` ë§¤í¬ë¡œë¥¼ í†µí•´ ë³„ë„ì˜ í•¨ìˆ˜ êµ¬í˜„ ì—†ì´ ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ getter ì‚¬ìš© ê°€ëŠ¥

	* getterë¡œ ë¶ˆëŸ¬ì˜¨ í•¨ìˆ˜ëŠ” ì •ì  í•¨ìˆ˜ì´ë¯€ë¡œ ë³„ë„ì˜ í¬ì¸í„°ê°€ í•„ìš”í•˜ì§€ ì•ŠìŒ

* Vigorë¥¼ ì–´ë””ë¡œë¶€í„° ìº¡ì²˜í• ì§€ Source/Target ì¤‘ ì„ íƒí•´ì•¼ í•¨

* `bSnapshot`: ì†ì„±ì„ ìº¡ì²˜í•  íƒ€ì´ë°. íš¨ê³¼ê°€ ì ìš©ë˜ëŠ” ì‹œì ì—ì„œ ì†ì„± ìº¡ì²˜

	* `Vigor`ëŠ” GEê°€ ìƒì„±ë˜ëŠ” ì¦‰ì‹œ ë™ì¼í•œ í•¨ìˆ˜ì—ì„œ GameplayEffectSpecì´ ì ìš©ë˜ë¯€ë¡œ ê´€ë ¨x

	* ***cf)** GESpecì„ ìƒì„±í•˜ê³  ê³µê¸° ì¤‘ìœ¼ë¡œ ë‚ ì•„ê°€ëŠ” ë¶ˆë©ì´ì— ì„¤ì •í•  ê²½ìš°, ë³„ë„ì˜ íƒ€ì´ë° ì§€ì •ì´ í•„ìš”í•¨*

* `RelevantAttributesToCapture`: ìº¡ì²˜í•  ì†ì„±ì„ `TArray`ì— ì¶”ê°€í•´ì•¼ í•¨

	* ìƒì„±ìì—ì„œ ì¶”ê°€í•´ êµ¬í˜„ë¶€ì—ì„œ í•´ë‹¹ ë°°ì—´ì— ì ‘ê·¼í•´ ì›í•˜ëŠ” ì†ì„± ì—°ì‚°